<div class="cart-page">
  
  <!-- Banner de Envío -->
  <div class="top-banner">
    <p class="mb-0">Envío gratis a todo el Perú por compras mayores a S/. 250</p>
  </div>

  <div class="container py-5">
    
    <!-- Si el carrito está vacío -->
    <div *ngIf="cartItems.length === 0" class="empty-cart">
      <i class="fas fa-shopping-cart fa-4x mb-3"></i>
      <h3>Tu carrito está vacío</h3>
      <p>Agrega productos para comenzar tu compra</p>
      <button class="btn btn-primary-custom" routerLink="/products">
        <i class="fas fa-store me-2"></i>
        Ir a la Tienda
      </button>
    </div>

    <!-- Si hay productos en el carrito -->
    <div *ngIf="cartItems.length > 0">
      
      <h1 class="cart-title mb-4">
        <i class="fas fa-shopping-cart me-3"></i>
        CARRITO DE COMPRAS
      </h1>

      <div class="row">
        
        <!-- Lista de Productos -->
        <div class="col-lg-8 mb-4">
          <div class="cart-items-container">
            
            <!-- Item del Carrito -->
            <div 
              class="cart-item" 
              *ngFor="let item of cartItems"
              [class.out-of-stock]="!tieneStock(item)"
            >
              <div class="row align-items-center">
                
                <!-- Imagen del Producto -->
                <div class="col-md-2 col-3">
                  <div class="item-image">
                    <img 
                      [src]="item.producto.imagen || 'assets/images/placeholder-product.jpg'" 
                      [alt]="item.producto.nombre" 
                      class="img-fluid"
                      (error)="$any($event.target).src='assets/images/placeholder-product.jpg'"
                    >
                  </div>
                </div>

                <!-- Información del Producto -->
                <div class="col-md-4 col-9">
                  <h5 class="item-name">{{ item.producto.nombre }}</h5>
                  <p class="item-category" *ngIf="item.producto.categoria">
                    {{ item.producto.categoria }}
                  </p>
                  <p class="item-price">s/. {{ item.producto.precio | number:'1.2-2' }}</p>
                  
                  <!-- Alerta de stock -->
                  <div class="stock-alert" *ngIf="!tieneStock(item)">
                    <i class="fas fa-exclamation-triangle me-1"></i>
                    Stock insuficiente (disponibles: {{ item.producto.stock }})
                  </div>
                  <div class="stock-warning" *ngIf="tieneStock(item) && item.producto.stock < 5">
                    <i class="fas fa-info-circle me-1"></i>
                    ¡Últimas {{ item.producto.stock }} unidades!
                  </div>
                </div>

                <!-- Cantidad -->
                <div class="col-md-3 col-6">
                  <div class="quantity-control">
                    <button 
                      class="btn-quantity" 
                      (click)="decreaseQuantity(item)"
                      [disabled]="item.cantidad <= 1"
                    >
                      <i class="fas fa-minus"></i>
                    </button>
                    <input 
                      type="number" 
                      class="quantity-input" 
                      [(ngModel)]="item.cantidad"
                      (change)="updateQuantity(item)"
                      [min]="1"
                      [max]="getMaxQuantity(item)"
                    >
                    <button 
                      class="btn-quantity" 
                      (click)="increaseQuantity(item)"
                      [disabled]="item.cantidad >= getMaxQuantity(item)"
                    >
                      <i class="fas fa-plus"></i>
                    </button>
                  </div>
                  <small class="quantity-hint">
                    Máx: {{ getMaxQuantity(item) }}
                  </small>
                </div>

                <!-- Subtotal -->
                <div class="col-md-2 col-4">
                  <p class="item-subtotal">
                    s/. {{ item.producto.precio * item.cantidad | number:'1.2-2' }}
                  </p>
                </div>

                <!-- Botón Eliminar -->
                <div class="col-md-1 col-2 text-end">
                  <button 
                    class="btn-remove" 
                    (click)="removeItem(item)"
                    aria-label="Eliminar producto"
                  >
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </div>

              </div>
            </div>

          </div>

          <!-- Botón Continuar Comprando -->
          <div class="cart-actions mt-4">
            <button class="btn btn-outline-custom" routerLink="/products">
              <i class="fas fa-arrow-left me-2"></i>
              Continuar Comprando
            </button>
            <button class="btn btn-outline-danger" (click)="clearCart()">
              <i class="fas fa-trash me-2"></i>
              Vaciar Carrito
            </button>
          </div>
        </div>

        <!-- Resumen del Pedido -->
        <div class="col-lg-4">
          <div class="cart-summary">
            
            <h4 class="summary-title">Resumen del Pedido</h4>

            <!-- Detalles del Precio -->
            <div class="summary-details">
              <div class="summary-row">
                <span>Subtotal ({{ getTotalItems() }} {{ getTotalItems() === 1 ? 'producto' : 'productos' }})</span>
                <span>s/. {{ getSubtotal() | number:'1.2-2' }}</span>
              </div>
              
              <div class="summary-row">
                <span>Envío</span>
                <span *ngIf="getSubtotal() >= 250" class="text-success">
                  <i class="fas fa-check-circle me-1"></i>GRATIS
                </span>
                <span *ngIf="getSubtotal() < 250">s/. {{ shippingCost | number:'1.2-2' }}</span>
              </div>

              <!-- Alerta de envío gratis -->
              <div class="free-shipping-alert" *ngIf="getSubtotal() < 250 && getSubtotal() > 0">
                <i class="fas fa-truck me-2"></i>
                Te faltan <strong>s/. {{ (250 - getSubtotal()) | number:'1.2-2' }}</strong> para envío gratis
                <div class="shipping-progress">
                  <div 
                    class="shipping-progress-bar" 
                    [style.width.%]="(getSubtotal() / 250) * 100"
                  ></div>
                </div>
              </div>

              <div class="summary-divider"></div>

              <div class="summary-row summary-total">
                <span>Total</span>
                <span>s/. {{ getTotal() | number:'1.2-2' }}</span>
              </div>
            </div>

            <!-- Botones de Acción -->
            <div class="summary-actions">
              <button 
                class="btn btn-primary-custom w-100 mb-3" 
                (click)="proceedToCheckout()"
              >
                <i class="fas fa-lock me-2"></i>
                PROCEDER AL PAGO
              </button>
              
              <!-- Características de seguridad -->
              <div class="security-features">
                <div class="security-item">
                  <i class="fas fa-shield-alt"></i>
                  <span>Compra 100% segura</span>
                </div>
                <div class="security-item">
                  <i class="fas fa-undo"></i>
                  <span>Devolución en 30 días</span>
                </div>
              </div>
            </div>

            <!-- Métodos de Pago -->
            <div class="payment-methods">
              <p class="payment-title">Aceptamos:</p>
              <div class="payment-icons">
                <i class="fab fa-cc-visa"></i>
                <i class="fab fa-cc-mastercard"></i>
                <i class="fab fa-cc-amex"></i>
                <i class="fas fa-money-bill-wave"></i>
              </div>
            </div>

          </div>
        </div>

      </div>

    </div>

  </div>

</div>